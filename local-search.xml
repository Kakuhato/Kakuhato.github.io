<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>test</title>
    <link href="/2025/01/17/hello-world/"/>
    <url>/2025/01/17/hello-world/</url>
    
    <content type="html"><![CDATA[<p>games101notes</p><h3 id="齐次坐标"><a href="#齐次坐标" class="headerlink" title="齐次坐标"></a>齐次坐标</h3><ul><li>2D点：$(x,y,\mathbf{1})^T$</li><li>2D向量：$(x,y,\mathbf{0})^T$</li></ul><p>最后一位需要的取值是保证向量的平移不变性。点与向量之间的运算关系为：</p><ul><li>$\text{向量}+\text{向量}&#x3D;\text{向量}$</li><li>$\text{点}-\text{点}&#x3D;\text{向量}$</li><li>$\text{向量}+\text{点}&#x3D;\text{向量}$​</li><li>$\text{点}+\text{点}&#x3D;\text{两点连线的中点}$</li></ul><p>$$<br>(x_1,y_1,1)^T+(x_2,y_2,1)^T&#x3D;(x_1+x_2,y_1+y_2,2)^T&#x3D;&gt;(\frac{x_1+x_2}{2},\frac{y_1+y_2}{2},1)<br>$$</p><h3 id="旋转"><a href="#旋转" class="headerlink" title="旋转"></a>旋转</h3><p>绕$x,y,z$轴旋转，这里坐标系是右手系，即$\vec{x}\times\vec{y}&#x3D;\vec{z}$</p><ul><li>$R_x(\alpha)&#x3D;\begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; 0 \ 0 &amp; \cos\alpha &amp; -\sin\alpha &amp; 0 \ 0 &amp; \sin\alpha &amp; \cos\alpha &amp; 0 \ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix}$</li><li>$R_y(\alpha)&#x3D;\begin{bmatrix} \cos\alpha &amp; 0 &amp; \sin\alpha &amp; 0 \ 0 &amp; 1 &amp; 0 &amp; 0 \ -\sin\alpha &amp; 0 &amp; \cos\alpha &amp; 0 \ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix}$</li><li>$R_z(\alpha)&#x3D;\begin{bmatrix} \cos\alpha &amp; -\sin\alpha &amp; 0 &amp; 0\ \sin\alpha &amp; \cos\alpha &amp; 0 &amp; 0\ 0 &amp; 0 &amp; 1 &amp; 0 \ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix}$</li></ul><p>一般性旋转，其中$\alpha,\beta,\gamma$​为欧拉角</p><p>$$<br>R_{xyz}(\alpha,\beta,\gamma)&#x3D;R_x(\alpha)R_y(\beta)R_z(\gamma)<br>$$</p><p>Rodrigues旋转公式推导</p><p><img src="/./img/Rodrigues.jpg" alt="Rodrigues"></p><p>设任意轴为$\hat{a}&#x3D;(x_a,y_a,z_a)^T$（$\Vert\hat{a}\Vert&#x3D;1$），需要旋转的向量为$\vec{S}$，旋转后的向量为$\vec{S^{rot}}$</p><p>$$<br>\vec{S^{rot}}&#x3D;\vec{S_\parallel}+\vec{S^{ROT}<em>\bot} \ \vec{S</em>\parallel}&#x3D;proj(\vec{S},\hat{a})&#x3D;\hat{a}  (\vec{S}\cdot\hat{a})&#x3D;\hat{a}\hat{a}^T\vec{S} \ \vec{S_\bot}&#x3D;\vec{S}-\vec{S_\parallel}&#x3D;\vec{S}-\hat{a}\hat{a}^T\vec{S} \ \hat{b}&#x3D;\frac{\vec{S_\bot}}{\Vert\vec{S_\bot}\Vert} \qquad \hat{c}&#x3D;\hat{a}\times\hat{b}&#x3D;\hat{a} \times \frac{\vec{S_\bot}}{\Vert\vec{S_\bot}\Vert} \qquad \Vert\vec{S^{ROT}<em>\bot}\Vert&#x3D;\Vert\vec{S</em>\bot}\Vert \ \vec{S^{ROT}<em>\bot}&#x3D;\Vert\vec{S^{ROT}</em>\bot}\Vert\cos(\theta)\hat{b}+\Vert\vec{S^{ROT}<em>\bot}\Vert\sin(\theta)\hat{c}&#x3D;\Vert\vec{S^{ROT}</em>\bot}\Vert\cos(\theta)\frac{\vec{S_\bot}}{\Vert\vec{S_\bot}\Vert}+\Vert\vec{S^{ROT}<em>\bot}\Vert\sin(\theta)(\hat{a} \times \frac{\vec{S</em>\bot}}{\Vert\vec{S_\bot}\Vert})&#x3D;\vec{S_\bot}\cos(\theta)+\hat{a} \times \vec{S_\bot}\sin(\theta)<br>\ \hat{a} \times \vec{S}&#x3D;\hat{a} \times (\vec{S_\bot} + \vec{S_\parallel})&#x3D;\hat{a} \times \vec{S_\bot} + \mathbf{0}<br>$$</p><p>进一步化简推导</p><p>$$<br>\begin{aligned}<br>\vec{S^{rot}}&amp;&#x3D;\vec{S_\parallel}+\vec{S^{ROT}<em>\bot} \<br>&amp;&#x3D;\hat{a}\hat{a}^T\vec{S}+\vec{S</em>\bot}\cos(\theta)+\hat{a} \times \vec{S_\bot}\sin(\theta) \<br>&amp;&#x3D;\hat{a}\hat{a}^T\vec{S}+(\vec{S}-\hat{a}\hat{a}^T\vec{S})\cos(\theta)+<br>\begin{bmatrix} 0 &amp; -z_a &amp; y_a \ z_a &amp; 0 &amp; -x_a \ -y_a &amp; x_a &amp; 0 \end{bmatrix}<br>\vec{S}\sin(\theta) \<br>&amp;&#x3D;[\hat{a}\hat{a}^T+(\vec{I}-\hat{a}\hat{a}^T)\cos(\theta)+<br>\begin{bmatrix} 0 &amp; -z_a &amp; y_a \ z_a &amp; 0 &amp; -x_a \ -y_a &amp; x_a &amp; 0 \end{bmatrix}<br>\sin(\theta)]\vec{S} \<br>&amp;&#x3D;[\vec{I}\cos(\theta)+(1-cos(\theta))\hat{a}\hat{a}^T+<br>\begin{bmatrix} 0 &amp; -z_a &amp; y_a \ z_a &amp; 0 &amp; -x_a \ -y_a &amp; x_a &amp; 0 \end{bmatrix}<br>\sin(\theta)]\vec{S}<br>\end{aligned}<br>$$</p><p>提取出变换组合$R(\hat{a},\theta)&#x3D;\vec{I}\cos(\theta)+(1-cos(\theta))\hat{a}\hat{a}^T+<br>\begin{bmatrix} 0 &amp; -z_a &amp; y_a \ z_a &amp; 0 &amp; -x_a \ -y_a &amp; x_a &amp; 0 \end{bmatrix}<br>\sin(\theta)$，需要注意这里的旋转轴$\hat{a}$是经过原点且为单位向量，若需要对任意不过原点的轴进行旋转，则对需要旋转的向量和旋转轴同时进行平移，使得旋转轴过原点。</p><h3 id="透视投影→正交投影"><a href="#透视投影→正交投影" class="headerlink" title="透视投影→正交投影"></a>透视投影→正交投影</h3><p><img src="/./img/perspective.jpg" alt="perspective"></p><p>在此之前，摄像机和物体一起移动，使得摄像机移动到原点，摄像机看向$Z$轴负方向，相机顶部为$Y$方向。相机的视野为视锥体，$zNear$（图中$n$）为视锥体靠近相机的近平面的$Z$轴坐标，$zFar$（图中$f$）为视锥体远离相机的远平面的$Z$轴坐标，两数均为<strong>负数</strong>（作业中给出的$zNear$和$zFar$为正数，在处理时需要变换符号）。<strong>变换时，近平面上的点不会发生坐标变换，远平面中心点不会发生坐标变换。</strong></p><p>对于视锥体边界上任意一点$(x,y,z)$，这里认为宽高比（aspect ratio）为1</p><p>$$<br>y\prime&#x3D;\frac{zNear}{z}y \qquad x\prime&#x3D;\frac{zNear}{z} x<br>$$</p><p>则对于远平面任意一点，第一个坐标代表原始坐标，第二个坐标表示变换后的坐标，第三个表示进行<strong>齐次除法</strong>（透视除法）前的坐标。<br>第二个坐标的前三项作图为一个立方体，第三个坐标的前三项作图为一个视锥体（但是这个视锥体和原始的视锥体略有不同）。</p><p>$$<br>\begin{bmatrix}<br>x \ y \ z \ 1 \<br>\end{bmatrix}<br>\propto<br>\begin{bmatrix}<br>\frac{zNear\cdot x}{z} \ \frac{zNear\cdot y}{z} \ * \ 1 \<br>\end{bmatrix}<br>\propto<br>\begin{bmatrix}<br>zNear\cdot x \ zNear\cdot y \ *z \ z \<br>\end{bmatrix}<br>$$</p><p>此时，可以得到变换矩阵的部分参数</p><p>$$<br>M_{persp\rightarrow ortho}&#x3D;<br>\begin{bmatrix}<br>zNear &amp; 0 &amp; 0 &amp; 0 \ 0 &amp; zNear &amp; 0 &amp; 0 \ * &amp; * &amp; * &amp; * \ 0 &amp; 0 &amp; 1 &amp; 0<br>\end{bmatrix}<br>$$</p><p>对于近平面任意一点$\begin{bmatrix}x \ y \ zNear \ 1 \\end{bmatrix}$，变换后的坐标为$\begin{bmatrix}x \ y \ zNear \ 1 \ \end{bmatrix}$，齐次除法前的坐标为$\begin{bmatrix}zNear\cdot x \ zNear\cdot y \ zNear^2 \ zNear \ \end{bmatrix}$，则有等式</p><p>$$<br>\begin{bmatrix}<br>zNear &amp; 0 &amp; 0 &amp; 0 \ 0 &amp; zNear &amp; 0 &amp; 0 \ * &amp; * &amp; * &amp; * \ 0 &amp; 0 &amp; 0 &amp; 1<br>\end{bmatrix}<br>\begin{bmatrix}x \ y \ zNear \ 1 \\end{bmatrix}<br>&#x3D;\begin{bmatrix}zNear\cdot x \ zNear\cdot y \ zNear^2 \ zNear \ \end{bmatrix}<br>$$</p><p>对于远平面的中心点$\begin{bmatrix}0 \ 0 \ zFar \ 1 \\end{bmatrix}$，变化后的坐标为$\begin{bmatrix}0 \ 0 \ zFar \ 1 \\end{bmatrix}$，齐次除法前的坐标为$\begin{bmatrix}0 \ 0 \ zFar^2 \ zFar \\end{bmatrix}$，则有等式</p><p>$$<br>\begin{bmatrix}<br>zNear &amp; 0 &amp; 0 &amp; 0 \ 0 &amp; zNear &amp; 0 &amp; 0 \ * &amp; * &amp; * &amp; * \ 0 &amp; 0 &amp; 0 &amp; 1<br>\end{bmatrix}<br>\begin{bmatrix} 0 \ 0 \ zFar \ 1 \<br>\end{bmatrix}<br>&#x3D;\begin{bmatrix} 0 \ 0 \ zFar^2 \ zFar \<br>\end{bmatrix}<br>$$</p><p>可解得矩阵$M_{persp\rightarrow ortho}$，这个矩阵实际上并没有将视锥体变为立方体，变换后的齐次位$\omega$（第四位）的值为变换前的$Z$轴坐标，前三位坐标绘制出的实际上是与原视锥体不同的另一个新视锥体，该新视锥体通过除以$\omega$进行齐次除法后得到的坐标才为立方体坐标。</p><p>$$<br>M_{persp\rightarrow ortho}&#x3D;<br>\begin{bmatrix}<br>zNear &amp; 0 &amp; 0 &amp; 0 \ 0 &amp; zNear &amp; 0 &amp; 0 \ 0 &amp; 0 &amp; zNear+zFar &amp; -zNear\cdot zFar \ 0 &amp; 0 &amp; 1 &amp; 0<br>\end{bmatrix}<br>$$</p><p>进一步需要把视锥体会被变换到一个立方体，这个立方体的$x,y,z$分量的范围都是$ [−1,1]$，且立方体的中心在原点。</p><p>$$<br>M_{orth}&#x3D;<br>\begin{bmatrix}<br>\frac{2}{right-left} &amp; 0 &amp; 0 &amp; 0 \ 0 &amp; \frac{2}{top-bottom} &amp; 0 &amp; 0 \ 0 &amp; 0 &amp; \frac{2}{zNear-zFar} &amp; -\frac{zNear+zFar}{2} \ 0 &amp; 0 &amp; 0 &amp; 1<br>\end{bmatrix}<br>$$</p><h4 id="需要注意的坐标数据流"><a href="#需要注意的坐标数据流" class="headerlink" title="需要注意的坐标数据流"></a>需要注意的坐标数据流</h4>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
